# CHANGELOG

Chrome拡張機能の変更履歴

## [Gmail2Notion v1.4.0] - 2024-12-19

### 🎉 新機能
- **メールプレビュー画面対応**: メール一覧でメールを選択した時の右側プレビュー画面にもボタンを表示
- **プレビューペイン検出**: `[role="complementary"]`と`.aeJ`セレクタを使用したプレビュー画面の自動検出
- **プレビュー専用監視**: プレビュー画面の変更を特別に監視する機能を追加

### 🔧 改善
- **要素検出の拡張**: プレビュー画面専用のセレクタを全ての要素抽出関数に追加
- **メール情報抽出の向上**: 件名、送信者、本文の抽出をプレビュー画面でも対応
- **ツールバー検出の強化**: プレビュー画面内のツールバーも正確に検出
- **デバッグログの拡充**: プレビューモード検出時の詳細ログを追加

### 📋 技術的改善
- プレビューペイン内の要素を優先的に検索
- 複数のプレビュー画面パターンに対応
- プレビュー画面とメール詳細画面の両方で安定動作

---

## [Gmail2Notion v1.3.0] - 2024-12-19

### 🔧 改善
- **要素セレクタの堅牢性向上**: aria-label属性を活用した要素検出の実装
- **Gmail画面構造変更への耐性向上**: 複数のセレクタパターンによるフォールバック機能
- **メール情報抽出の精度向上**: 
  - 件名、送信者、受信者、送信日時、本文の抽出精度を向上
  - より詳細なデバッグログの追加
- **画像抽出の改善**: aria-label属性を活用した画像検出の追加
- **エラーハンドリングの強化**: 各要素が見つからない場合の詳細ログ出力

### 📋 技術的改善
- DevToolsを使った要素調査手法の活用
- Gmailの最新UI構造に対応したセレクタの追加
- 要素検出の成功/失敗状況の詳細ログ出力
- フォールバック機能による安定性の向上

---

## [LCchat2notion v1.1.6] - 2024-12-19

### 🔧 重要な修正
- **テキスト抽出の完全修正**: Notionアイコンテキスト（"保存中..."等）の混入を完全除去
- **タイムスタンプ処理の改善**: `extractTime`関数を使用してNotionアイコンテキストを確実に除去
- **重複防止システムの強化**: Jaccard類似度アルゴリズムによる高精度な重複検出
- **テキスト抽出の優先順位**: つぶやき投稿専用セレクタの優先度調整
- **コンテンツ検証の強化**: 空のテキストや不正なコンテンツの保存を防止

### 🎯 つぶやき投稿対応
- **専用セレクタ追加**: `.originalTweetArea`、`.tweetArea`等のつぶやき専用セレクタ
- **緊急テキスト抽出**: つぶやきコンテナからの直接テキスト抽出機能
- **ユニークID生成**: つぶやき投稿専用のID生成システム
- **フォールバック処理**: 通常の抽出が失敗した場合の緊急処理

### 🛠️ 技術的改善
- **extractElementContent関数**: Notionアイコンテキストの除去処理を統一
- **validateAndCleanContent関数**: "保存不可"ステータスによる無効コンテンツの除外
- **類似度計算**: テキストの重複を精密に検出するアルゴリズム
- **エラーハンドリング**: ユーザーフレンドリーなエラーメッセージの実装

## [LCchat2notion v1.1.5] - 2024-12-19

### 🎯 ワークスペース最上位作成対応（API制限により動作せず）
- **プライベートセクション直下に作成**: ワークスペースの最上位（プライベートセクション直下）に直接ページとデータベースを作成を試行
- **確実な配置**: 既存ページ検索を廃止し、常にワークスペース最上位に作成されることを保証を試行
- **視覚的改善**: 📁 と 🗃️ アイコンでページとデータベースを区別
- **詳細説明の追加**: 作成されたページに拡張機能による自動作成である旨を明記

### 🔧 改善
- **親ページ作成の簡素化**: 複雑な既存ページ検索ロジックを削除
- **タイムスタンプ付き命名**: 重複を避ける日付ベースの命名規則
- **分かりやすいタイトル**: 「LibeCity チャット投稿データベース」として目的を明確化
- **Calloutブロック**: 拡張機能による作成であることを視覚的に表示

### ⚠️ 注意
- Notion APIの制限により、ワークスペース最上位への直接作成は不可能でした
- v1.1.6で既存ページを利用する方式に修正されました

---

## [LCchat2notion v1.1.4] - 2024-12-19

### 🎉 新機能
- **標準データベース作成機能**: ポップアップメニューから専用データベースを簡単作成
- **ワンクリックセットアップ**: 「標準データベースを作成」ボタンでLibeCity専用DBを自動生成
- **自動データベース選択**: 作成されたデータベースが自動的に選択される
- **標準スキーマ適用**: Title、URL、Author、Chat、Date、Tags、Statusの最適化されたプロパティ構成

### 🔧 改善
- **ユーザビリティの向上**: 既存データベースとの互換性問題を回避
- **初期設定の簡素化**: APIキー設定後、すぐに専用データベースを作成可能
- **視覚的フィードバック**: データベース作成中の進捗表示とアニメーション
- **エラーハンドリング**: データベース作成失敗時の詳細なエラー情報表示

### 📋 技術的改善
- createStandardDatabase関数の実装
- データベース作成UIコンポーネントの追加
- 親ページ自動検索・作成機能
- 作成後の自動データベース選択機能

---

## [LCchat2notion v1.1.3] - 2024-12-19

### 🎯 重要な互換性修正
- **既存データベース対応**: 任意のNotionデータベースプロパティに動的マッピング
- **プロパティ自動変換**: Title↔rich_text、select値の自動調整
- **柔軟なフィールドマッピング**: 日本語・英語プロパティ名の自動判定
- **必須プロパティの自動確保**: タイトル用プロパティの緊急マッピング

### 🔧 技術的改善
- 動的プロパティマッピングシステムの実装
- データベーススキーマ検証の大幅強化
- 型変換機能の追加（rich_text ↔ title）
- select型プロパティのデフォルト値設定

### 📋 対応プロパティ
- **タイトル系**: Title, タイトル, ToDo, Task, Name, 名前
- **URL系**: URL, Link, リンク, Source, ソース
- **作成者系**: Author, 作成者, 担当者, Creator, User
- **内容系**: Chat, チャット, Content, 内容, Description
- **日付系**: Date, 日付, 作成日時, 実行日, Created
- **ステータス系**: Status, ステータス, Done, 完了
- **タグ系**: Tags, タグ, Category, 分類, Label

---

## [LCchat2notion v1.1.2] - 2024-12-19

### 🔧 デバッグ改善
- **詳細エラー情報の出力**: 保存エラー時の詳細な原因を特定可能に
- **Notion APIエラーの詳細ログ**: API呼び出し失敗時の詳細情報を出力
- **エラーハンドリングの改善**: より具体的なエラーメッセージの提供
- **デバッグ情報の拡充**: 問題の特定と解決を容易にする詳細ログ

### 🛠️ 技術的改善
- makeNotionRequest関数のエラー処理強化
- saveToNotion関数の例外処理改善
- APIレスポンスエラーの詳細解析機能追加

---

## [LCchat2notion v1.1.1] - 2024-12-19

### 🐛 バグ修正
- **設定保存の信頼性向上**: 別のChromeプロファイルでAPIトークン設定時のエラーを修正
- **詳細なデバッグログ追加**: 設定保存・取得時の詳細な状況をログ出力
- **エラーメッセージの改善**: より具体的なエラー原因の表示
- **設定形式の互換性向上**: 新旧両方の設定保存形式に対応

### 🔧 技術的改善
- 設定保存後の即座な検証処理を追加
- Background scriptとPopup間の通信エラーハンドリングを強化
- APIキー設定状態の詳細確認機能を追加
- データベース取得時の設定確認ロジックを改善

---

## [LCchat2notion v1.1.0] - 2024-12-19

## [1.1.0] - 2024-12-19

### ✅ 修正
- **エラー表示の完全修正**: ユーザーに分かりやすいエラーメッセージを実装
- **コンソールエラーの完全除去**: 開発者コンソールからエラー出力を削除
- **画像保存エラーハンドリング**: 画像保存失敗時もテキストは正常に保存される
- **つぶやき投稿の重複保存問題**: 同じつぶやき投稿が複数回保存される問題を修正
- **長文投稿の自動最適化**: 文字数制限を超える投稿の自動調整機能

### 🔧 改善
- **つぶやき投稿専用システム**: つぶやき投稿と通常投稿の処理を完全分離
- **アイコン管理システム**: 保存状態の視覚的フィードバックを統一
- **画像データ構造**: Content ScriptとBackground Script間のデータ構造を統一
- **重複検出アルゴリズム**: Jaccard類似度を使用した精密な重複検出
- **エラーハンドリング**: 各処理段階での詳細なエラー処理を実装

### 🐛 バグ修正
- Notionボタンの重複表示問題
- 画像付き投稿でテキストが保存されない問題
- つぶやき投稿でのタイムスタンプ混入問題
- 通常投稿でのNotionボタン非表示問題
- 画像URLの参照エラー問題

## [1.0.0] - 2024-12-15

### 🎉 初回リリース
- **基本的な投稿保存機能**: LibeCityの投稿をNotionに保存
- **Notionデータベース自動作成**: 専用スキーマでデータベースを自動生成
- **画像とテキストの保存**: 投稿内の画像とテキストを同時保存
- **Chrome Web Store対応**: 公開用パッケージの作成
- **親ページ選択機能**: データベース作成先のページを選択可能
- **重複防止機能**: 同じ投稿の重複保存を防止

### 📋 対応機能
- 通常のチャット投稿保存
- つぶやき投稿保存
- 画像付き投稿の処理
- リンク付き投稿の処理
- Notion API連携
- ユーザー設定管理

---

## リリースノート

### v1.1.0の主要改善点

このバージョンでは、ユーザーから報告されたエラーや問題を包括的に解決しました：

1. **エラー表示の改善**: 技術的なエラーメッセージを分かりやすい日本語メッセージに変更
2. **つぶやき投稿の完全対応**: 専用処理システムにより安定した保存を実現
3. **画像保存の信頼性向上**: 画像保存失敗時の適切な処理とユーザー通知
4. **重複保存の防止**: より精密なアルゴリズムで重複を完全に防止
5. **開発者体験の向上**: コンソールエラーを除去し、クリーンな実行環境を実現

### 今後の予定

- ユーザーフィードバックに基づく機能改善
- 新しいコンテンツタイプへの対応
- パフォーマンスの最適化
- UI/UXの継続的改善 