# Gmail to Notion転送拡張機能 要求仕様書

## 1. 概要

### 1.1 目的
Gmailで開いているメールの内容を、指定したNotionデータベースに簡単に保存できるChrome拡張機能を開発する。

### 1.2 主要機能
- Gmail画面にメール保存ボタンを追加
- メール内容をNotionデータベースに自動転送
- メール情報の構造化された保存

## 2. 機能要件

### 2.1 基本機能

#### 2.1.1 メール保存ボタンの表示
- **表示場所**: Gmailのメール詳細画面のツールバー部分
- **ボタンデザイン**: Notionアイコン + "Notionに保存" テキスト
- **表示条件**: メールが開かれている状態

#### 2.1.2 メール情報の抽出と保存形式
以下の情報を抽出し、指定された形式で保存：

**タイトルプロパティに保存：**
- **件名** (Subject) - そのままタイトルとして使用

**URLプロパティに保存：**
- **GmailメールURL** - メールへの直接リンク

**ページコンテンツに保存：**
- **送信者** (From)
- **受信者** (To)
- **CC/BCC** (存在する場合)
- **送信日時** (Date)
- **メール本文** (Body)
- **添付ファイル情報** (ファイル名のみ)
- **その他のメール詳細情報**

#### 2.1.3 Notion連携機能
- **認証**: Notion APIキーによる認証
- **データベース選択**: 事前に設定された既存のNotionデータベースへの保存
- **データ形式**: 
  - タイトル: メールの件名
  - URL: GmailのメールURL
  - ページコンテンツ: メール詳細情報をマークダウン形式で構造化

### 2.2 設定機能

#### 2.2.1 初期設定画面
- **Notion APIキー設定**
- **対象データベースID設定**
- **保存項目のカスタマイズ設定**

#### 2.2.2 オプション設定
- **自動保存の有効/無効**
- **保存完了通知の表示設定**
- **既存データベース構造の確認機能**
- **ページコンテンツフォーマットの設定**

## 3. 技術仕様

### 3.1 Chrome拡張機能構成
```
gmail-notion-extension/
├── manifest.json          # 拡張機能の設定ファイル
├── content-script.js      # Gmail画面に注入されるスクリプト
├── background.js          # バックグラウンド処理
├── popup.html            # 設定用ポップアップ画面
├── popup.js              # ポップアップの動作制御
├── options.html          # 詳細設定画面
├── options.js            # 設定画面の動作制御
└── assets/               # アイコンやスタイルファイル
    ├── icon16.png
    ├── icon48.png
    ├── icon128.png
    └── styles.css
```

### 3.2 使用するAPI
- **Notion API v1**: データベースへのページ作成
- **Gmail DOM**: メール情報の抽出（公式APIは使用しない）

### 3.3 権限設定
```json
{
  "permissions": [
    "activeTab",
    "storage",
    "https://api.notion.com/*"
  ],
  "host_permissions": [
    "https://mail.google.com/*"
  ]
}
```

## 4. ユーザーインターフェース

### 4.1 Gmail画面での表示
- **保存ボタン**: メールツールバーに統合
- **保存状態インジケーター**: 保存中/完了/エラーの表示
- **進捗表示**: 保存処理中のローディング表示

### 4.2 設定画面
- **シンプルな設定フォーム**
- **接続テスト機能**
- **データベース構造のプレビュー**

### 4.3 通知機能
- **保存完了通知**: ブラウザ通知またはページ内通知
- **エラー通知**: 認証失敗やネットワークエラーの表示

## 5. Notionデータベース構造

### 5.1 使用するプロパティ（既存データベース前提）
| プロパティ名 | タイプ | 使用方法 |
|-------------|--------|----------|
| タイトル | タイトル | メールの件名を記載 |
| URL | URL | GmailのメールURL（直接リンク）を記載 |

### 5.2 メール詳細情報の保存場所
- **ページコンテンツ**: メール本文の全内容
  - 送信者情報
  - 受信者情報
  - 送信日時
  - メール本文
  - その他のメール詳細

### 5.3 データベース構造の保護
- **既存プロパティの変更禁止**
- **新規プロパティの追加禁止**
- **データベース設定の変更禁止**

## 6. セキュリティ要件

### 6.1 認証情報の管理
- **APIキーの暗号化保存**
- **ローカルストレージの適切な使用**
- **設定情報の安全な管理**

### 6.2 データ処理
- **メール内容の一時的な処理のみ**
- **機密情報の永続化禁止**
- **HTTPS通信の必須化**

## 7. エラーハンドリング

### 7.1 想定されるエラー
- **Notion API認証エラー**
- **データベースアクセスエラー**
- **ネットワーク接続エラー**
- **メール情報抽出エラー**

### 7.2 エラー対応
- **ユーザーフレンドリーなエラーメッセージ**
- **リトライ機能**
- **ログ機能（デバッグ用）**

## 8. 開発・テスト要件

### 8.1 対応ブラウザ
- **Chrome 88以降**
- **Edge 88以降（Chromium版）**

### 8.2 テスト項目
- **基本的なメール保存機能**
- **様々なメール形式での動作確認**
- **Notion API連携テスト**
- **エラーケースのテスト**

## 9. 運用要件

### 9.1 配布方法
- **Chrome Web Storeでの公開**
- **プライベート配布オプション**

### 9.2 サポート
- **基本的な使用方法の説明**
- **トラブルシューティングガイド**
- **アップデート通知機能**

## 10. 今後の拡張可能性

### 10.1 追加機能候補
- **複数データベースへの振り分け保存**
- **メールの自動分類機能**
- **添付ファイルの実際の保存**
- **他のメールサービス対応（Outlook等）**

### 10.2 連携サービス拡張
- **Notion以外のサービス対応**
- **Zapier等の自動化ツール連携** 